Description: Properly guard `face_index` before attempting to read its value
 (CVE-2022-27405).
Author: Werner Lemberg
Origin: https://gitlab.freedesktop.org/freetype/freetype/-/commit/22a0cccb4d9d002f33c1ba7a4b36812c7d4f46b5
Bug: https://gitlab.freedesktop.org/freetype/freetype/-/issues/1139
Bug-Debian: https://bugs.debian.org/1010183
Last-Update: 2022-04-28

Index: freetype-2.5.2/src/base/ftobjs.c
===================================================================
--- freetype-2.5.2.orig/src/base/ftobjs.c	2023-05-27 13:54:15.181715038 +0200
+++ freetype-2.5.2/src/base/ftobjs.c	2023-05-27 13:54:15.177715039 +0200
@@ -2095,6 +2095,15 @@
     FT_Module*   cur;
     FT_Module*   limit;
 
+    /* only use lower 31 bits together with sign bit */
+    if ( face_index > 0 )
+      face_index &= 0x7FFFFFFFL;
+    else
+    {
+      face_index  = -face_index;
+      face_index &= 0x7FFFFFFFL;
+      face_index  = -face_index;
+    }
 
     /* test for valid `library' delayed to */
     /* FT_Stream_New()                     */
